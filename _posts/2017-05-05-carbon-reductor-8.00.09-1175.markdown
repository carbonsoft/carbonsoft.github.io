---
title: Carbon Reductor 8.00.09 (1175)
---

# Carbon Reductor 8.00.09 (1175)

Добрый день! За последние пару месяцев разработчики хорошо потрудились и выложили крупное обновление в devel-ветку, которое уже протестировано и доступно для скачивания. Расскажем о нём в порядке важности изменений.

## Самое важное

Исправлена редкая ошибка, приводившая к зависаниям серверов (soft-lockup) и последующей перезагрузке. Всего было зафиксировано 4 случая на 700 серверов, к счастью, они обошлись без последствий, благодаря использованию резервных серверов фильтрации.

По умолчанию было включено логирование срабатываний HTTP-модуля, которое полезно для отладки, но значительно повышает время срабатывания редиректа. Настоятельно рекомендуем проверить настройки и отключить эту опцию, если сотрудники техподдержки не сообщили Вам обратное.

Исправлены проблемы со стартом сервиса фильтрации при изменении параметров ipset, ранее приводило к запуску режима обслуживания и уведомлениям администраторов о возникшей проблеме.

Сервис bgp_blackhole теперь поддерживает работу с IP адресами подсетей.

Запуск активации мог приводить к уходу сервиса reductor в режим обслуживания при неприменённых ручных изменениях в модулях фильтрации, конфигурации ipset. Маловероятно, но неприятно.

## Списки, реестр, выгрузки

Недавно мы обнаружили особенность работы АС "Ревизор" - он обновляет списки Роскомнадзора через час после того, как они обновятся в источнике. Carbon Reductor обновляет списки в течение нескольких минут после их изменения со стороны Роскомнадзора. Это привело к ситуации, что АС "Ревизор" зафиксировал фиктивный пропуск по устаревшему списку - сайт, который ранее был заблокирован, разблокировали, но информация о нём в АС "Ревизор" обновилась позже чем в Carbon Reductor. Теперь используются все списки за последние 24 часа (по умолчанию, но опционально) для исключения рассинхронизации с АС "Ревизор".

Добавлена возможность просматривать изменения выгруженных из реестра Роскомнадзора списков с помощью git в папке `/var/lib/reductor/rkn_history/lists/` (за исключением результатов резолвера и временных файлов от обработки списков).

Добавлена проверка отсутствия файлов запроса и подписи в утилите для выгрузки единого реестра с понятным выводом ошибки для администратора. В заблуждение попадали пользователи, переключившие выгрузку реестра с собственного сервера на Carbon Reductor на выгрузку с использованием запроса и подписи к серверу Роскомнадзора. Проверка работает как при запуске выгрузки, так и при автоматической диагностике сервера.

Добавлена возможность использования Крипто-Про для подписи запроса на сервере с Carbon Reductor 8.

Исправлено:

- Список минюста не отображался в веб-интерфейсе
- Работа белых списков IP адресов (https)
- Просмотр информации о списках в веб-интерфейсе показывал информацию не обо всех списках.
- Демон проверки единого реестра rknd отслеживал только срочные изменения, теперь отслеживает все (интервал проверки - раз в 5 минут).
- Заполнение списка доменов ресурсов, использующих HSTS при выборе соответствующей опции в мастере настройки.
- не работала проверка окончания срока действия сертификата.

## Интеграция с сетью провайдера

Добавлена поддержка интеграции Carbon Reductor с несколькими маршрутизаторами - система отправки команд (events.sh) теперь поддерживает список хуков, в которых определяется порядок взаимодействия с маршрутизатором.

## Информация о сервере

- В вывод информации о сервере добавлена оценка аппаратной части по шкале от 1 до 10 для того, чтобы Вы и техподдержка могли более полноценно контролировать актуальность Вашего сервера.
- Вывод информации о сервере теперь показывает все установленные модели процессоров. Сделано для машин с несколькими разными процессорами (но так лучше не делать).
- VLAN-интерфейсы для приема зеркала трафика отображались с выводом ошибок ethtool.

## Боремся за безопасность

Бывают случаи, когда локальная сеть не очень хорошо защищена, поэтому мы добавили пару вещей, которые дополнительно напомнят о безопасности Вашего сервера фильтрации:

- Проверка смены пароля пользователя root в диагностике. Теперь отображается ошибка в случае использования стандартного пароля.
- В мастере настройки предлагается использовать нестандартный порт для SSH. При использовании стандартного, диагностика будет выводить ошибку.

## Режим обслуживания

Стабилизирована работа режима обслуживания, теперь он запускается при любом рестарте файрвола, даже если не требуется изменять ipset и модули фильтрации. Также его можно отключить в меню.

## Прочее

Добавлено:

- Возможность указать несколько IP-адресов АС "Ревизор" через пробел на случай необходимости проведения технического обслуживания сервера.
- Добавлена возможность сбора дампа трафика от АС "Ревизор" с помощью инструкции с примерами. Помогает для отладки вновь установленного сервера.
- Диагностика возможности зацикливания HTTPS-прокси если HSTS-ресурс резолвится редуктором в его собственный IP адрес. Такое может происходить в случае, если осуществляется фильтрация с помощью DNS-сервера провайдера и при этом и страница заглушка и прокси-сервер находятся на одном сервере.

Исправлено:

- Минорные ошибки в новом контейнере bgp_blackhole.
- Вывод ошибок диагностике в веб-интерфейсе теперь показывает только текущие проблемы.
- Выводящиеся в интерфейсе ссылки вели на документацию по Carbon Reductor 7.
- Мастер настройки зеркала трафика мог не отображать некоторые сетевые устройства.
- У некоторых вновь пришедших пользователей возникали проблемы с установкой с DVD-диска, теперь установка работает исправно.
- Утилита cache_ctl не работала
- Примеры утилиты list_ctl
- Проблема с правами на временные файлы nginx приводила к отображению веб-интерфейса без CSS.
- Имена ipset в firewall теперь соответствуют спискам, которые в них загружаются.
- Проверка наличия трафика теперь использует счётчики модулей фильтрации вместо запуска tcpdump, так же учитывается включены модули или нет.
